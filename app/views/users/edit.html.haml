- title "Redigera profil för #{@user.displayname}"
%section.box.form#edit-user
  %h1.box-title= h1
  .box-content
    = form_for @user, html: { class: "form-horizontal" } do |f|
      - if @user.errors.any?
        .warning= t 'messages.validation_errors'

      - if @user_roles.empty?
        %p.warning= "Välj en eller flera förvaltningar och arbetsfält nedan."
      - elsif !@user_roles.include? 'department'
        %p.warning= "Välj en eller flera förvaltningar nedan."
      - elsif !@user_roles.include? 'working_field'
        %p.warning= "Välj en eller flera arbetsfält nedan."

      .control-group.readonly
        .control-label Namn:
        .controls
          = "#{@user.first_name} #{@user.last_name}"
          = link_to "(Info)", "#", class: "show-change-info"
          .change-info
            %p= "Ditt namn hämtas från HR-systemet. Ditt namn kan du ändra genom att kontakta din egen förvaltnings lokala HR-funktion. Det vanligaste är att du vill ändra för att ditt namn är felstavat eller för att du byter efternamn."
            %p= "Kontaktuppgift till din lokala HR-finktion hittar du på Komin > Min förvaltning > Vår organisation."

      .control-group.readonly
        .control-label HR-titel:
        .controls
          = @user.title
          = link_to "(Info)", "#", class: "show-change-info"
          .change-info
            %p= "Din HR-titel hämtas från HR-systemet och kontaktboken visar den titel som är kopplad till din primära anställning. Din HR-titel är den titel du fick med när du anställdes i Malmö stad. Ändring av HR-titeln kan endast göras när du byter tjänst."
            %p= "Om du upplever att du är anställd med fel titel, diskutera med din linjechef."

      .control-group
        = f.label :professional_bio, "Om mig:", class: "control-label"
        .controls
          = f.text_area :professional_bio, class: "input-wide", rows: 7
          %p.help= raw  "Skriv en kort beskrivning av vad du arbetar med i Malmö stad, vad du ansvarar för. <em>Observera</em>: personligt om dig (exempelvis ”två barn, gillar att resa”) skriver du in i fältet ”Personlig bio” längre ned på sidan, <em>inte</em> här."

      .control-group.readonly
        .control-label Förvaltning:
        .controls
          = @user.company_short
          = link_to "(Info)", "#", class: "show-change-info"
          .change-info
            %p= "Din förvaltning hämtas från HR-systemet och kontaktboken visar den förvaltningstillhörighet som är kopplad till din primära anställning."
            %p= "Om du upplever att kontaktboken visar en annan förvaltning än den du är anställd i, kontakta kominteamet@malmo.se."

      .control-group.readonly
        .control-label Avdelning:
        .controls
          = @user.department

      .control-group
        = f.label :status_message, "Statusmeddelande:", class: "control-label"
        .controls
          = f.text_field :status_message, class: "input-wide"
          %p.help= raw "Skriv vad du arbetar med just nu. Kollegor som följer dig kan då se detta. Din status visas och kan också uppdateras direkt på ”Min sida”."

      %h2.form-group-title#roles Grundprofil i Komin:

      .control-group
        .control-label= "Förvaltningar:"
        .controls
          %p.help= "Här väljer du vilken/vilka förvaltningar/arbetsfält du vill se i Kominflikarna Min förvaltning, Mitt arbetsfält högst upp i Komin."
          - if !@user_roles.include? 'department'
            %p.warning= "Välj en eller flera förvaltningar."
          - @roles.select { |r| r.category == "department" }.each do |role|
            %label.checkbox
              = check_box_tag "user[role_ids][]", role.id, @user.role_ids.include?(role.id), id: dom_id(role)
              = role.name

      .control-group
        .control-label= "Arbetsfält:"
        .controls
          - if !@user_roles.include? 'working_field'
            %p.warning= "Välj en eller flera arbetsfält."
          - @roles.select { |r| r.category == "working_field" }.each do |role|
            %label.checkbox
              = check_box_tag "user[role_ids][]", role.id, @user.role_ids.include?(role.id), id: dom_id(role)
              = role.name

      %h2.form-group-title Kontakt

      .control-group.readonly
        .control-label E-post:
        .controls
          = @user.email
          = link_to "(Info)", "#", class: "show-change-info"
          .change-info
            %p= "Din e-postadress finns lagrad i Malmö stads centrala databas över alla anställda. Kontaktboken visar vilken epostadress som är knuten till dig. Om det visas fel epostadress, kontakta ITS, 040-342727."

      .control-group.readonly
        .control-label Fast telefon:
        .controls
          = @user.phone
          .change-info
            %p
              = "Ditt fasta telefonnummer finns lagrat i Malmö stads centrala databas över alla anställda. Kontaktboken visar vilket nummer som är knutet till dig. Om det visas fel telefonnummer beställer du en ändring i "
              = link_to "IT-kompassen.", "http://marval.malmo.se/MSMSelfService/Itservice/telefoni-forandring.aspx"
              = "Om du behöver hjälp, kontakta ITS, 040-342727."

      .control-group.readonly
        .control-label Mobiltelefon:
        .controls
          = @user.cell_phone
          = link_to "(Info)", "#", class: "show-change-info"
          .change-info
            %p
              = "Ditt mobilnummer finns lagrat i Malmö stads centrala databas över alla anställda. Kontaktboken visar vilket nummer som är knutet till dig. Om det visas fel telefonnummer beställer du en ändring i "
              = link_to "IT-kompassen.", "http://marval.malmo.se/MSMSelfService/Itservice/telefoni-forandring.aspx"
              = "Om du behöver hjälp, kontakta ITS, 040-342727."

      .control-group
        = f.label :skype, "Skype:", class: "control-label"
        .controls= f.text_field :skype, class: "input-wide"

      %h2.form-group-title Kompetensprofil

      .control-group
        = f.label :skill_list, "Kunskapsområden:", class: "control-label"
        .controls
          = f.text_field(:skill_list, class: "input-wide", data: { path: skills_suggest_path, load: @user.skills.map{ |l| { id: l.name, name: l.name }}})
          %p.help= "Skriv in ord som beskriver saker du kan, har ansvar för och sådant som du ska förknippas med i Malmö stad. När en kollega söker efter ett ord du angett får de träff på dig."

      .control-group
        = f.label :language_list, "Språkkunskaper:", class: "control-label"
        .controls
          = f.text_field(:language_list, class: "input-wide", data: { path: languages_suggest_path, load: @user.languages.map{ |l| { id: l.name, name: l.name }}})
          %p.help= "Om du vill kan du ange vilka språk du kan. Detta kan hjälpa till internt i organisationen när en kollega letar efter en viss kompetens till ett projekt/en aktivitet."


      %h2.form-group-title Personsligt

      .control-group
        = f.label :private_bio, "Om mig, personlig bio:", class: "control-label"
        .controls
          = f.text_area :private_bio, class: "input-wide", rows: 7
          %p.help= raw "Om du vill kan du skriva en personlig presentation om dig. <em>Observera:</em> yrkespresentationen om dig (vad du arbetar med i Malmö stad, vad du ansvarar för) skriver du in i fältet ”Om mig” högre upp på sidan, <em>inte</em> här."

      .control-group
        = f.label :twitter, "Twitter:", class: "control-label"
        .controls
          .input-prepend
            %span.add-on @
            = f.text_field :twitter, class: "input-wide"
          %p.help= "Om du vill kan du ange vilken Twitteradress du har."

      .control-group
        = f.label :homepage, "Privat hemsida:", class: "control-label"
        .controls
          = f.text_field :homepage, class: "input-wide"
          %p.help= "Om du vill kan du ange vilken privat hemsida du har."

      - if admin?
        .control-group.editable
          .control-label Administratör:
          .controls
            %label.checkbox
              = f.check_box :admin
              Ja
            - @user.errors[:admin].each do |msg|
              .help-inline.warning= "#{msg}"

        .control-group.editable
          .control-label Early adopter:
          .controls
            %label.checkbox
              = f.check_box :early_adopter
              Ja

      .control-group
        .controls
          = f.submit t( 'actions.save' ), class: "btn btn-primary"
          = link_to t( 'actions.cancel' ), user_path(@user.username), class: "btn"

